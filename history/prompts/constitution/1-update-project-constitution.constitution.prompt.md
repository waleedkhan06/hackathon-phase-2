---
id: 1
title: update-project-constitution
stage: constitution
date: 2026-02-05
surface: agent
model: claude-sonnet-4-5-20250929
feature: none
branch: master
user: waleedkhan
command: sp.constitution
labels: [constitution, governance, todo-app]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
 - .specify/memory/constitution.md
tests:
 - none
---

## Prompt

```text
# Todo Full-Stack Application â€“ Phase II Constitution
# (Hackathon Project â€“ Agentic Dev Stack with Claude Code + Spec-Kit Plus)

You are the principal AI development agent building a multi-user full-stack todo web application.

## Core Directive
Follow the Agentic Dev Stack workflow strictly â€” no exceptions:
1. Write / refine Specification â†’ (use spec-writer agent or manual spec review)
2. Generate Plan / Architecture
3. Break into small atomic tasks
4. Implement exclusively via Claude Code generation (no manual coding allowed)
5. Iterate, test, refine

All code must be generated by Claude. Manual edits are prohibited.

## Project Overview & Phase Goal
Phase II: Transform the Phase I console todo app into a modern multi-user web application with:
- Persistent storage in Neon Serverless PostgreSQL
- RESTful API backend (FastAPI + SQLModel)
- Responsive frontend (Next.js 16+ App Router, TypeScript, Tailwind)
- User authentication & authorization using Better Auth + JWT tokens
- Strict user data isolation (each user only sees/modifies their own tasks)

## Mandatory Technology Stack
Frontend
- Next.js 16+ (App Router)
- TypeScript (strict mode)
- Tailwind CSS
- Better Auth (with JWT plugin)

Backend
- FastAPI
- SQLModel (ORM)
- Python 3.11+
- PyJWT (for token verification)

Database
- Neon Serverless PostgreSQL
- Connection via environment variable: DATABASE_URL

Authentication
- Better Auth (frontend issues JWT)
- Shared secret: BETTER_AUTH_SECRET (identical in frontend & backend)
- JWT algorithm: HS256
- Backend verifies token and extracts user_id from "sub" claim

Monorepo Structure (mandatory â€“ do not deviate)
hackathon-todo/
â”œâ”€â”€ .spec-kit/
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ overview.md
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ task-crud.md
â”‚   â”‚   â””â”€â”€ authentication.md
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ rest-endpoints.md
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ schema.md
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ components.md
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ coordinator.md
â”‚   â”œâ”€â”€ spec-writer.md
â”‚   â”œâ”€â”€ frontend.md
â”‚   â”œâ”€â”€ backend-core.md
â”‚   â”œâ”€â”€ database.md
â”‚   â”œâ”€â”€ auth.md
â”‚   â””â”€â”€ api-endpoints.md
â”‚   â””â”€â”€ skills/
â”‚       â”œâ”€â”€ nextjs-app-router-patterns.md
â”‚       â”œâ”€â”€ fastapi-modern-patterns.md
â”‚       â”œâ”€â”€ sqlmodel-database-rules.md
â”‚       â”œâ”€â”€ jwt-auth-security.md
â”‚       â””â”€â”€ ...
â”œâ”€â”€ frontend/
â”œâ”€â”€ backend/
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md

## Security & Authorization Rules â€“ Non-negotiable
1. Every protected API endpoint MUST verify JWT token
2. Extract user_id from token payload["sub"]
3. Compare with user_id in URL path â†’ 403 Forbidden if mismatch
4. Every database query MUST filter by user_id = authenticated user_id
5. Return 401 Unauthorized on ming:
- Always state which part of the constitution applies
- Reference relevant spec or agent files
- Suggest next step in workflow
```

## Response snapshot

Updated the project constitution at .specify/memory/constitution.md with the following principles:
- Agentic Dev Stack Workflow
- Multi-User Data Isolation
- Security-First Architecture
- Modern Tech Stack Adherence
- Monorepo Structure Compliance
- Test-First Development

The constitution now defines the technology stack requirements and development workflow for the Todo Full-Stack Application.

## Outcome

- âœ… Impact: Created new constitution file with all required principles
- ğŸ§ª Tests: No tests required for constitution update
- ğŸ“ Files: Updated .specify/memory/constitution.md
- ğŸ” Next prompts: Proceed with specification development
- ğŸ§  Reflection: Constitution provides clear governance for the project

## Evaluation notes (flywheel)

- Failure modes observed: None
- Graders run and results (PASS/FAIL): N/A
- Prompt variant (if applicable): N/A
- Next experiment (smallest change to try): Begin with specification development